@page "/calender"
@using Syncfusion.Blazor.Schedule
@using Models;

<div class="weekly-schedule">
    <div class="schedule-header">
        <button @onclick="PreviousWeek">&lt;</button>
        <h4>@weekStartDate.ToString("MMM dd, yyyy") - @weekStartDate.AddDays(6).ToString("MMM dd, yyyy")</h4>
        <button @onclick="NextWeek">&gt;</button>
    </div>

    <div class="schedule-grid">
        <div class="time-column"></div>
        @foreach (var day in Enumerable.Range(0, 7))
        {
            <div class="day-header">@weekStartDate.AddDays(day).ToString("ddd")</div>
        }

        @foreach (var hour in Enumerable.Range(0, 24))
        {
            <div class="time-column">@hour:00</div>
            @foreach (var day in Enumerable.Range(0, 7))
            {
                var currentDateTime = weekStartDate.AddDays(day).AddHours(hour);
                <div class="schedule-cell" @onclick="() => AddEvent(currentDateTime)">
                    @foreach (var ev in GetEventsForTimeSlot(currentDateTime))
                    {
                        <div class="event">
                            <span>@ev.eventname</span>
                            <button class="remove-event" @onclick="() => RemoveEvent(ev.randomuniqcode)">X</button>
                        </div>
                    }
                </div>
            }
        }
    </div>
</div>

<style>
    .weekly-schedule {
        max-width: 1200px;
        margin: 20px auto;
        font-family: Arial, sans-serif;
    }

    .schedule-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .schedule-grid {
        display: grid;
        grid-template-columns: 80px repeat(7, 1fr);
        gap: 5px;
    }

    .time-column {
        font-weight: bold;
        text-align: center;
        padding: 5px;
        background-color: #f5f5f5;
        border: 1px solid #ccc;
    }

    .day-header {
        font-weight: bold;
        text-align: center;
        padding: 10px;
        background-color: #f0f8ff;
        border: 1px solid #ccc;
    }

    .schedule-cell {
        border: 1px solid #ccc;
        min-height: 50px;
        cursor: pointer;
        position: relative;
    }

        .schedule-cell:hover {
            background-color: #f0f0f0;
        }

    .event {
        background-color: #007bff;
        color: white;
        padding: 5px;
        margin: 2px 0;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .remove-event {
        background: none;
        border: none;
        color: white;
        font-size: 12px;
        cursor: pointer;
        margin-left: 5px;
    }

        .remove-event:hover {
            color: red;
        }
</style>

@code {
    private DateTime weekStartDate = DateTime.Today.StartOfWeek(DayOfWeek.Monday);
    private List<Event> events = new List<Event>();

    private void PreviousWeek()
    {
        weekStartDate = weekStartDate.AddDays(-7);
    }

    private void NextWeek()
    {
        weekStartDate = weekStartDate.AddDays(7);
    }

    private void AddEvent(DateTime dateTime)
    {
        var newEventName = "New Event"; // Replace with user input if desired
        events.Add(new Event
            {
               
                eventname = newEventName,
                date = dateTime
            });
    }

    private void RemoveEvent(int eventId)
    {
        events.RemoveAll(e => e.randomuniqcode == eventId);
    }

    private IEnumerable<Event> GetEventsForTimeSlot(DateTime dateTime)
    {
        return events.Where(e => e.date == dateTime);
    }

    
}

public static class DateTimeExtensions
{
    public static DateTime StartOfWeek(this DateTime dt, DayOfWeek startOfWeek)
    {
        int diff = (7 + (dt.DayOfWeek - startOfWeek)) % 7;
        return dt.AddDays(-1 * diff).Date;
    }
}


